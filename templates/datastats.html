
{% load static from staticfiles %}

<head>
<title>Data Stats</title>
<style type="text/css">
.tab-content {
    display: block;
	
    padding: 30px 12px;
    border-top: none;
    text-align: center;
    font-size:20px
}
.para-content {
display: block;
    padding: 30px 12px;
	
    border-top: none;
    text-align: center;
    font-size:20px
}
.back-button {
padding: 3px;
display:block;
color: black;
text-align:center;
position: absolute;
top: 60px;
left: 10px;
}
.back-home {
padding: 30px 12px;
position: absolute;
display:block;
text-align:center;
top: 10px;
left:45%;
}

.page-logo .logo-default {
	margin: 6px 0 0;width: 10%;}
.page-logo > a {
	display: initial; float: initial;}
.page-container {
	margin-top: 92px;}

.page-content {
	padding: 0px 0 0 20px;}
        </style>
<link href="{% static 'layouts/layout4/css/layout.min.css' %}" rel="stylesheet" type="text/css" />
        <link href="{% static 'layouts/layout4/css/themes/light.min.css' %}" rel="stylesheet" type="text/css" id="style_color" />
        <link href="{% static 'layouts/layout4/css/custom.min.css' %}" rel="stylesheet" type="text/css" />
		

<!-- BEGIN LOGO -->
                <div class="page-logo">
                    <a href="/">
                        <img src="{% static 'internal/images/vectorscient-logo.svg' %}" alt="logo" class="logo-default" /> </a>
                    
                </div>
                <!-- END LOGO -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script src="{% static 'global/plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.js' %}" type="text/javascript"></script>
<script src="{% static 'global/plugins/typeahead/handlebars.min.js' %}" type="text/javascript"></script>
<script src="{% static 'global/plugins/typeahead/typeahead.bundle.min.js' %}" type="text/javascript"></script>

<script>


    /*
  $('#fileinput').submit(function(e) {
    e.preventDefault();
   alert("Successfully uploaded..!"+post_data);
   var post_data = $('input[type=file]')[0].files[0];
   
   $.ajax({
    type: "POST",
    url: "/datastats/",
    data: { csrfmiddlewaretoken: "{{ csrf_token }}",    
             state:"inactive",
	data: post_data 
          },
    success: function() {
        alert("Successfully uploaded..!"+post_data)
        console.log("prototype")
    },
  error:function(error){
    console.log(error);
  }

})

});

*/
</script>
<head>
{% block content %}

 <form  method="get" class="tab-content">

        <p class="para-content"> Here you can calculate different set of statistics for the data you want. <br>
	Follow the steps below to generate statistics : <br>
	<!--	Give the input details. This could be a file from your local computer, or a file from remote server or a database table <br>
	Choose the attributes you want to generate the statistics for. <br>
	Click on Generate statistics to get the detailed report of statistics<br>
	You can also save the result to a csv file <br>  -->
	
	</p>
        <input type="radio"  name="n" id="id1" value="1"  onclick="displayForm(this)">Input Details<br><br>
    <!--    <input type="radio"  name="n" id="id2" value="2"  onclick="displayForm(this)"> Output details<br><br>	--> 	
        <input type="radio"  name="n" id="id3" value="3"  onclick="displayForm(this)">Configure Attributes<br><br>
        <input type="radio"  name="n" id="id4" value="4"  onclick="displayForm(this)">Generate Statistics<br>
		<a href="{% url 'index' %}"  value = "backtohome" class="back-home">Home Page </a>

        </form>



<form style="display:none" id="inputmethod"   class="tab-content"  >
<table align = "center">
<td>
<p>Please choose the input type you want: </p>
   <select onchange="ChangeDropdowns(this)">
  <option value="" > Please choose </option>
  <option id = "csvlocal"  value="1"  onchange="ChangeDropdowns(this)">CSV file from local machine</option>
  <option id = "csv_remote"  value="2"   onchange="ChangeDropdowns(this)">CSV file from remote server</option>
  <option id = "dbtable"  value="3"   onchange="ChangeDropdowns(this)">Database Table</option>
</select>
</td>
</table>
</form>




    <form style="display:none"    id="fileinput"  name="fileinput"  method = "POST"    enctype="multipart/form-data"    class="tab-content"   action="."  >
<input type="hidden" name="form-type" value="micro-form" /> <!-- set type -->
<table align = "center">
<td>
<p>Select a CSV file from your local computer and submit it </p>
       {% csrf_token %} 
        <input type = "file" id = "inputfile" name = "inputfile"   value = "inputfile"   accept=".csv" />
        
        <!--  -->    <button type="submit" id="file-save-submit"   value = "s" > Submit it </button> 
</td>
</table>
    </form>





{% if file %}
<p class="para-content" > {{file}}    is   submitted <br>
Now click on "Configure Attributes" and select the attributes you want the statistics for.<br>
If you want to give a different input, click the black button above.<br> </p> 
<button  value = "backtoinput" class="back-button" onclick="goBack(this)">Go Back to give a different input</button>	
{% endif %} 




<form style="display:none"    id="dbinput"  name="dbinput"  method = "POST"    enctype="multipart/form-data"    class="tab-content"   action="."  >
{% csrf_token %}
<input type="hidden" name="form-type" value="db-form" /> <!-- set type -->
<table align = "center">
<td>
<label> Enter the host name: <input type="text" id="host" name = "host"/> </label><br>
<label> Enter the database name: <input type="text" id="db" name = "db"/> </label><br>
<label> Enter the username: <input type="text" id="username" name = "username"/> </label><br>
<label> Enter the password: <input type="password" id="password" name = "password"/> </label><br> 
<button type="submit" id="db-details-submit"   value = "s1" > Submit the details </button>
</td>
</table>
</form> 



	
{% if conn %}
{{success_msg}} <br>
<form    style="display:inline"    id="selecttable"    method = "POST"    class="tab-content"  action="." >
<input type="hidden" name="form-type" value="table-form" /> <!-- set type -->
 <table column = "1" align = "center">
<td>
{% csrf_token %}
 <p> Choose any one table :  <br><br>
{% for field in tablenames %}
 <input type = "radio"  name = "selecttable"  value = "{{field}}"   id = "selecttable" />
{{field}}   <br><br>
  {% endfor %}
<button type="submit" id="table-submit"   value = "table-submit" > Submit</button>  
</td>
</table>
</form>
{% endif %}
{% if erro_msg %}
{{erro_msg}}<br> 
{{error}}<br> 
<button  value = "backtodbDetails" onclick="goBack(this)">Go back and Give proper connection details</button>
{% endif %}




<form    style="display:none"    id="selecttablecolumn"    method = "POST"    class="tab-content"  action="." >
<input type="hidden" name="form-type" value="table-column-form" /> <!-- set type -->
 <table column = "1" align = "center">
<td>
{% csrf_token %}
{% if selected_table %}
 <p> Choose one or more attributes to configure :  <br><br>
{% for field in columnnames %}
 <input type = "checkbox"  name = "selecttablecolumn"  value = "{{field}}"   id = "selecttablecolumn" />
{{field}}   <br><br>
  {% endfor %}
<button type="submit" id="table-column-submit"   value = "table-submit" > Submit</button>  
{% endif %}
</td>
</table>
</form>

		


   <form style="display:none" id="outputfile"   class="tab-content">
<table align = "center">
<td>
<p>Select an output file :  </p>
        <input type="file" id= "outfile"  name = "outfilename " value="outfileval" />
</td>
</table>
    </form>




  <form    style="display:none"    id="configtabs"    method = "POST"    class="tab-content"  action="." >
<input type="hidden" name="form-type" value="blog-form" /> <!-- set type -->
 <table column = "1" align = "center">
<td>
{% csrf_token %}
{% if file %}
 <p> Choose one or more attributes to configure :  <br><br>
{% for field in x %}
 <input type = "checkbox"  name = "configtabs"  value = "{{field}}"   id = "configtabs" />
{{field}}   <br><br>
  {% endfor %}
<button type="submit" id="config-submit"   value = "configsubmit" onclick = "generateStats(this)" > Submit</button> 
{% endif %}  
     </p>
   </td>
</table>
</form>





{% if attributes %}
<p> These are the selected attributes : <br>  
{% for val in attributes %}
<li> {{ val }} <br> </li> 
{% endfor %}<br> 
 Now, click on "Generate Statistics"  to calculate statistics for the attributes you selected.</p> 
 <h4> Note: </h4> 
Statistics are generated for numerical attributes only. Non-numerical attributes are ignored. 
You can also save the result to a CSV file
<button  value = "backtoatts" class="back-button" onclick="goBack(this)">Go Back to select more attributes</button>
{% endif %} 





<form style="display:none" id="stats" method = "get" class="tab-content">
<table column = "1" align = "center">
<td>
<label> What statistics do you want to measure ? </label><br><br>
<input type = "checkbox"  name = "configtabs" />Mean <br><br>
<input type = "checkbox"  name = "configtabs" />Median <br><br>
<input type = "checkbox"  name = "configtabs" />Std Dev <br><br>
<input type = "checkbox"  name = "configtabs" />Z-Score <br><br>
<input type = "checkbox"  name = "configtabs" />p-value <br><br>
<input type = "checkbox"  name = "configtabs" />t-stat <br><br>
<input type = "checkbox"  name = "configtabs" />Quartile Deviations <br><br>
<input type = "submit" value = "Generate Statistics .. " />
</td>
</table>
</form>




<form style="display:none"  id="genstats"  class="tab-content"  method = "POST"  action = " ">
{% csrf_token %}

<p> RESULT</p>
<input type="hidden" name="form-type" value="save-as-csv" /> <!-- set type -->
{% if attributes %}
{{result | safe}} <br> 
<button type="submit" id="file_save_csv"  name = "file_save_csv"  value = "file_save_csv" > Save As CSV file </button> 
{% elif table_columns %} 
{{result_from_table | safe}} <br> 

<button type="submit" id="table_save_csv"  name = "table_save_csv" value = "table_save_csv" > Save As CSV file </button> 

{% else %} 
<h4> Please choose the attributes to generate stats </h4> 
{% endif  %} 
</form>



{% if directory_f %}
<h4> CSV file saved to {{directory_f}} </h4> 
{% endif %} 
{% if directory_t %}
<h4> CSV file saved to {{directory_t}} </h4> 
{% endif %}






<script type="text/javascript"> 
        function displayForm(c){ 
       
            if(c.value == "1"){ 

    	 document.getElementById("inputmethod").style.display='inline'; 
     	
            } 

            if(c.value == "2"){ 

    	 // document.getElementById("outputfile").style.display='inline'; 
     
            } 
            if(c.value =="3"){ 
	
	var i= "{{file}}"
	var j= "{{columnnames}}"
	if(i){
	document.getElementById("configtabs").style.display='inline'; 
	}	
    else if(j){
	document.getElementById("selecttablecolumn").style.display='inline'; 
	}
	else 
	alert("Please provide input details..!")
	
	} 
            if(c.value =="4"){ 
	
	document.getElementById("genstats").style.display='inline'; 
	var checkboxes=document.getElementsByName("configtabs");
   	 var okay=false;
   	 for(var i=0,l=checkboxes.length;i<l;i++)
  	  {
      	  if(checkboxes[i].checked)
       	 {
           	 okay=true;
           	 break;
       	 }
 	   }
   	 if(okay){
	alert("Please scroll down.. ");
	document.getElementById("genstats").style.display='inline'; 
	}
    	// else alert("Please select atleast one attribute to generate statistics.. ");
            }

            else{ 
            } 
         }      

		 
		 
  function ChangeDropdowns(c){

  	  if(c.value=="1"){
	
        	 document.getElementById("fileinput").style.display='inline'; 
 	   }

	if(c.value=="3"){
		document.getElementById("dbinput").style.display='inline';
	}
}

 
   

function generateStats()
{
	
	
	document.getElementById("genstats").style.display='inline'; 

}

function goBack(c) {
    if(c.value=="backtoinput")
	document.getElementById("inputmethod").style.display='inline'; 
	
	if(c.value=="backtoatts"){
	
	window.history.back();
	window.onunload = function(){};
	document.getElementById("configtabs").style.display='inline'; 
	}
	
	if(c.value=="backtoattsagain"){
	window.history.back();
	window.onunload = function(){};
	document.getElementById("configtabs").style.display='inline'; 
	}
	if(c.value=="backtohome")
	window.history.back();
	
	if(c.value=="backtodbDetails")
	document.getElementById("dbinput").style.display='inline'; 
}



    </script>  

{% endblock %}
